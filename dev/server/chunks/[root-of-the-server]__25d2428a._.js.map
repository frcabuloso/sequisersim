{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/try/Downloads/BackupGeral/fr/web/carteiradigital/app/api/deposits/route.ts"],"sourcesContent":["\"use server\"\n\nimport { NextRequest, NextResponse } from \"next/server\"\n\n// Deposit rates - Only PIX and Crypto\nconst DEPOSIT_RATES = {\n  pix: 0.005, // 0.5%\n  crypto: 0.01 // 1.0%\n}\n\nconst CRYPTO_ADDRESSES: Record<string, { address: string; network: string }> = {\n  usdt_trc20: { address: \"TN8gJ7xZ2K9mQ5wEr3Yb6Pm1Vq8Nc4Lj\", network: \"TRC20\" },\n  usdt_erc20: { address: \"0x742d35Cc6634C0532925a3b844Bc9e7595f8bF2a\", network: \"ERC20\" },\n  btc: { address: \"bc1qxy2kgdygjrsqtzq2n0yrf2493p83kkfjhx0wlh\", network: \"Bitcoin\" },\n  eth: { address: \"0x742d35Cc6634C0532925a3b844Bc9e7595f8bF2a\", network: \"Ethereum\" },\n  ltc: { address: \"ltc1qhz8gxkmjc7t3knhfvz9fzqjxlqkzpxrjnqy7e4\", network: \"Litecoin\" }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const authHeader = request.headers.get(\"authorization\")\n    if (!authHeader?.startsWith(\"Bearer \")) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const body = await request.json()\n    const { \n      metodo, \n      valor,\n      pin,\n      cryptoCurrency\n    } = body\n\n    // Validate method\n    if (![\"pix\", \"crypto\"].includes(metodo)) {\n      return NextResponse.json({ error: \"Invalid payment method. Only PIX and Crypto are supported.\" }, { status: 400 })\n    }\n\n    // Validate PIN\n    if (!pin || pin.length !== 6) {\n      return NextResponse.json({ error: \"PIN required\" }, { status: 400 })\n    }\n\n    // Validate amount\n    const amount = parseFloat(valor)\n    if (isNaN(amount) || amount <= 0) {\n      return NextResponse.json({ error: \"Invalid amount\" }, { status: 400 })\n    }\n\n    // Calculate fee\n    const rate = DEPOSIT_RATES[metodo as keyof typeof DEPOSIT_RATES]\n    const fee = amount * rate\n    const netAmount = amount - fee\n\n    // Generate idempotency key\n    const idempotencyKey = `deposit_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`\n\n    let processingResult: Record<string, unknown> | null = null\n\n    switch (metodo) {\n      case \"pix\":\n        // Generate PIX QR Code\n        const pixPayload = generatePixPayload(amount)\n        processingResult = {\n          txid: `PIX${Date.now()}`,\n          qrCode: pixPayload,\n          qrCodeBase64: Buffer.from(pixPayload).toString(\"base64\"),\n          copiaECola: pixPayload,\n          expiresAt: new Date(Date.now() + 30 * 60 * 1000).toISOString() // 30 min\n        }\n        break\n\n      case \"crypto\":\n        if (!cryptoCurrency) {\n          return NextResponse.json({ error: \"Cryptocurrency required\" }, { status: 400 })\n        }\n        \n        const cryptoInfo = CRYPTO_ADDRESSES[cryptoCurrency]\n        if (!cryptoInfo) {\n          return NextResponse.json({ error: \"Unsupported cryptocurrency\" }, { status: 400 })\n        }\n\n        processingResult = {\n          currency: cryptoCurrency,\n          walletAddress: cryptoInfo.address,\n          network: cryptoInfo.network,\n          expiresAt: new Date(Date.now() + 60 * 60 * 1000).toISOString() // 1 hour\n        }\n        break\n\n      default:\n        return NextResponse.json({ error: \"Invalid payment method\" }, { status: 400 })\n    }\n\n    const deposit = {\n      id: idempotencyKey,\n      metodo,\n      valorBruto: amount,\n      taxa: fee,\n      valorLiquido: netAmount,\n      status: \"pending\",\n      processing: processingResult,\n      createdAt: new Date().toISOString()\n    }\n\n    return NextResponse.json({\n      success: true,\n      deposit\n    })\n  } catch {\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n\n// Generate PIX payload (EMV format)\nfunction generatePixPayload(amount: number): string {\n  const merchantName = \"FRLINDO\"\n  const merchantCity = \"SAO PAULO\"\n  const txid = Math.random().toString(36).substr(2, 25).toUpperCase()\n  \n  // This is a simplified PIX payload. In production, use proper EMV generation\n  const payload = `00020126580014br.gov.bcb.pix0136${txid}5204000053039865404${amount.toFixed(2)}5802BR5913${merchantName}6009${merchantCity}62070503***`\n  \n  return payload\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const authHeader = request.headers.get(\"authorization\")\n    if (!authHeader?.startsWith(\"Bearer \")) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const deposits = [\n      {\n        id: \"deposit_1\",\n        metodo: \"pix\",\n        valorBruto: 1000.00,\n        taxa: 5.00,\n        valorLiquido: 995.00,\n        status: \"completed\",\n        createdAt: new Date(Date.now() - 43200000).toISOString()\n      },\n      {\n        id: \"deposit_2\",\n        metodo: \"crypto\",\n        currency: \"usdt_trc20\",\n        valorBruto: 500.00,\n        taxa: 5.00,\n        valorLiquido: 495.00,\n        status: \"completed\",\n        createdAt: new Date(Date.now() - 86400000).toISOString()\n      }\n    ]\n\n    return NextResponse.json({ deposits })\n  } catch {\n    return NextResponse.json({ error: \"Internal server error\" }, { status: 500 })\n  }\n}\n"],"names":[],"mappings":"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"}}]
}